<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng nháº­p há»‡ thá»‘ng IoT</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="d-flex align-items-center justify-content-center vh-100 bg-light">

<div class="card p-4" style="min-width:350px;">
  <h3 class="mb-3 text-center">ğŸ” ÄÄƒng nháº­p IoT Dashboard</h3>

  <div class="mb-3">
    <label class="form-label">TÃ i khoáº£n</label>
    <input type="text" id="username" class="form-control">
  </div>

  <div class="mb-3">
    <label class="form-label">Máº­t kháº©u</label>
    <input type="password" id="password" class="form-control">
  </div>

  <div class="d-grid gap-2">
    <button class="btn btn-primary" id="btnLogin">ÄÄƒng nháº­p</button>
    <button class="btn btn-secondary" id="btnRegister">ÄÄƒng kÃ½</button>
  </div>

  <div class="mt-3 text-danger" id="msg"></div>
</div>

<script>
async function callApi(path, body) {
  const res = await fetch(path, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });
  return res.json();
}

document.getElementById("btnRegister").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const msgEl = document.getElementById("msg");
  msgEl.textContent = "";

  const data = await callApi("/api/auth/register", { username, password });
  if (data.error) msgEl.textContent = data.error;
  else msgEl.textContent = "ÄÄƒng kÃ½ thÃ nh cÃ´ng, hÃ£y Ä‘Äƒng nháº­p.";
});

document.getElementById("btnLogin").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const msgEl = document.getElementById("msg");
  msgEl.textContent = "";

  const data = await callApi("/api/auth/login", { username, password });
  if (data.error) msgEl.textContent = data.error;
  else {
    msgEl.style.color = "green";
    msgEl.textContent = "ÄÄƒng nháº­p thÃ nh cÃ´ng!";
    // LÆ°u token táº¡m vÃ o localStorage (náº¿u sau nÃ y cáº§n báº£o vá»‡ route)
    localStorage.setItem("iot_token", data.token);
    // VÃ­ dá»¥ chuyá»ƒn sang dashboard chÃ­nh:
    setTimeout(() => window.location.href = "/", 1000);
  }
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·ªãch s·ª≠ d·ªØ li·ªáu c·∫£m bi·∫øn</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-4">

  <h2 class="mb-3">üìú L·ªãch s·ª≠ SensorData</h2>

  <form class="row g-3 mb-3" id="filterForm">
    <div class="col-md-4">
      <label class="form-label">T·ª´ l√∫c</label>
      <input type="datetime-local" id="start" class="form-control" required>
    </div>
    <div class="col-md-4">
      <label class="form-label">ƒê·∫øn l√∫c</label>
      <input type="datetime-local" id="end" class="form-control" required>
    </div>
    <div class="col-md-4 d-flex align-items-end">
      <button class="btn btn-primary me-2" type="submit">L·ªçc</button>
      <button class="btn btn-secondary" type="button" id="btnAll">Xem t·∫•t c·∫£ (500 b·∫£n ghi)</button>
    </div>
  </form>

  <table class="table table-bordered table-striped" id="historyTable">
    <thead class="table-dark">
      <tr>
        <th>DataID</th>
        <th>SensorID</th>
        <th>Value</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
async function loadAll() {
  const res = await fetch("/api/sensor-data");
  const rows = await res.json();
  renderTable(rows);
}

function renderTable(rows) {
  const tb = document.querySelector("#historyTable tbody");
  tb.innerHTML = "";
  rows.forEach(r => {
    tb.innerHTML += `
      <tr>
        <td>${r.DataID}</td>
        <td>${r.SensorID}</td>
        <td>${r.Value}</td>
        <td>${new Date(r.Timestamp).toLocaleString("vi-VN")}</td>
      </tr>
    `;
  });
}

document.getElementById("filterForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const start = document.getElementById("start").value;
  const end = document.getElementById("end").value;
  if (!start || !end) return;

  // convert datetime-local ‚Üí format "YYYY-MM-DD HH:mm:ss"
  const startStr = start.replace("T", " ") + ":00";
  const endStr = end.replace("T", " ") + ":00";

  const url = `/api/sensor-data/filter?start=${encodeURIComponent(startStr)}&end=${encodeURIComponent(endStr)}`;
  const res = await fetch(url);
  const rows = await res.json();
  renderTable(rows);
});

document.getElementById("btnAll").addEventListener("click", loadAll);

// load m·∫∑c ƒë·ªãnh
loadAll();
</script>
</body>
</html>
